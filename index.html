<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Malzeme SihirbazÄ±</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{font-family:system-ui,Segoe UI,Inter,Arial,sans-serif;background:#fef2f2}
    .card{max-width:900px;margin:24px auto;background:#fff;border-radius:16px;
      box-shadow:0 8px 24px rgba(0,0,0,.08);padding:24px}
    .spinner{border:4px solid rgba(239,68,68,.25);border-top-color:#ef4444;border-radius:50%;
      width:26px;height:26px;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <div class="card">
    <h1 class="text-3xl font-bold text-red-600 text-center mb-2">ğŸ³ Malzeme SihirbazÄ±</h1>
    <p class="text-center text-gray-600 mb-6">Evdeki malzemeleri gir â†’ AI sana 3 tarif Ã¶nerisi versin.</p>

    <label class="font-semibold">Malzemeler (virgÃ¼lle ayÄ±r):</label>
    <input id="ingredients" type="text" class="w-full border rounded p-3 mb-3"
           placeholder="Ã¶rnek: yumurta, domates, patates, yoÄŸurt"/>

    <label class="font-semibold">Ek filtre (isteÄŸe baÄŸlÄ±):</label>
    <input id="filters" type="text" class="w-full border rounded p-3 mb-4"
           placeholder="Ã¶rnek: vejetaryen, 30 dakikadan kÄ±sa, glutensiz"/>

    <button id="btn" class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold rounded p-3">
      3 Tarif Ã–nerisi Bul
    </button>

    <div id="spinner" class="spinner mx-auto my-5 hidden"></div>
    <div id="result" class="space-y-4 mt-2"></div>
  </div>

  <script>
    const el = (id) => document.getElementById(id);
    const btn = el('btn'), spinner = el('spinner'), result = el('result');

    const card = (r) => `
      <div class="border border-red-200 bg-red-50 rounded p-4">
        <h2 class="text-xl font-bold text-red-700 mb-1">${r.recipeName}</h2>
        <div class="text-sm text-gray-600 mb-3">â± ${r.prepTime}</div>

        <p class="font-semibold text-gray-800 mb-1">Gerekli Malzemeler:</p>
        <ul class="list-disc pl-6 mb-3">${(r.ingredients||[]).map(x=>`<li>${x}</li>`).join('')}</ul>

        <details class="mt-2">
          <summary class="cursor-pointer text-red-600 font-semibold">AdÄ±m AdÄ±m Tarif</summary>
          <ol class="list-decimal pl-6 mt-2">${(r.instructions||[]).map(s=>`<li class="mb-1">${s}</li>`).join('')}</ol>
        </details>

        <div class="mt-3 text-sm text-gray-700">
          Kalori: <b>${r?.nutritionalInfo?.calories||'-'}</b> â€¢
          Protein: ${r?.nutritionalInfo?.protein||'-'} â€¢
          YaÄŸ: ${r?.nutritionalInfo?.fat||'-'} â€¢
          Karb: ${r?.nutritionalInfo?.carbs||'-'}
        </div>
      </div>
    `;

    btn.addEventListener('click', async () => {
      const ingredients = el('ingredients').value.trim();
      const filters = el('filters').value.trim();
      if(!ingredients){ alert('LÃ¼tfen malzemeleri girin.'); return; }

      spinner.classList.remove('hidden');
      result.innerHTML = '';

      try{
        const resp = await fetch('/api/suggest', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ ingredients, filters })
        });
        const data = await resp.json();
        if(!resp.ok) throw new Error(data.error || 'API hatasÄ±');

        const recipes = Array.isArray(data.recipes) ? data.recipes : [];
        if(recipes.length===0){
          result.innerHTML = `<div class="p-4 bg-yellow-50 border border-yellow-200 rounded">
            Uygun tarif bulunamadÄ±. Bir-iki malzeme daha deneyin.</div>`;
        }else{
          result.innerHTML = recipes.slice(0,3).map(card).join('');
        }
      }catch(e){
        result.innerHTML = `<div class="p-4 bg-red-50 border border-red-200 rounded">
          Hata: ${e.message}</div>`;
      }finally{
        spinner.classList.add('hidden');
      }
    });

    // Enter ile Ã§alÄ±ÅŸtÄ±rma
    ['ingredients','filters'].forEach(id=>{
      el(id).addEventListener('keydown', e=>{
        if(e.key==='Enter') btn.click();
      });
    });
  </script>
</body>
</html>
