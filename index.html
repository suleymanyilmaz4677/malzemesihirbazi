<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Malzeme Sihirbazı</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{font-family:system-ui,Segoe UI,Inter,Arial,sans-serif;background:#fef2f2}
    .card{max-width:900px;margin:24px auto;background:#fff;border-radius:16px;
      box-shadow:0 8px 24px rgba(0,0,0,.08);padding:24px}
    .spinner{border:4px solid rgba(239,68,68,.25);border-top-color:#ef4444;border-radius:50%;
      width:26px;height:26px;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <div class="card">
    <h1 class="text-3xl font-bold text-red-600 text-center mb-2">🍳 Malzeme Sihirbazı</h1>
    <p class="text-center text-gray-600 mb-6">Evdeki malzemeleri gir → AI sana 3 tarif önerisi versin.</p>

    <label class="font-semibold">Malzemeler (virgülle ayır):</label>
    <input id="ingredients" type="text" class="w-full border rounded p-3 mb-3"
           placeholder="örnek: yumurta, domates, patates, yoğurt"/>

    <label class="font-semibold">Ek filtre (isteğe bağlı):</label>
    <input id="filters" type="text" class="w-full border rounded p-3 mb-4"
           placeholder="örnek: vejetaryen, 30 dakikadan kısa, glutensiz"/>

    <button id="btn" class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold rounded p-3">
      3 Tarif Önerisi Bul
    </button>

    <div id="spinner" class="spinner mx-auto my-5 hidden"></div>
    <div id="result" class="space-y-4 mt-2"></div>
  </div>

  <script>
    const el = (id) => document.getElementById(id);
    const btn = el('btn'), spinner = el('spinner'), result = el('result');

    const card = (r) => `
      <div class="border border-red-200 bg-red-50 rounded p-4">
        <h2 class="text-xl font-bold text-red-700 mb-1">${r.recipeName}</h2>
        <div class="text-sm text-gray-600 mb-3">⏱ ${r.prepTime}</div>

        <p class="font-semibold text-gray-800 mb-1">Gerekli Malzemeler:</p>
        <ul class="list-disc pl-6 mb-3">${(r.ingredients||[]).map(x=>`<li>${x}</li>`).join('')}</ul>

        <details class="mt-2">
          <summary class="cursor-pointer text-red-600 font-semibold">Adım Adım Tarif</summary>
          <ol class="list-decimal pl-6 mt-2">${(r.instructions||[]).map(s=>`<li class="mb-1">${s}</li>`).join('')}</ol>
        </details>

        <div class="mt-3 text-sm text-gray-700">
          Kalori: <b>${r?.nutritionalInfo?.calories||'-'}</b> •
          Protein: ${r?.nutritionalInfo?.protein||'-'} •
          Yağ: ${r?.nutritionalInfo?.fat||'-'} •
          Karb: ${r?.nutritionalInfo?.carbs||'-'}
        </div>
      </div>
    `;

    btn.addEventListener('click', async () => {
      const ingredients = el('ingredients').value.trim();
      const filters = el('filters').value.trim();
      if(!ingredients){ alert('Lütfen malzemeleri girin.'); return; }

      spinner.classList.remove('hidden');
      result.innerHTML = '';

      try{
        const resp = await fetch('/api/suggest', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ ingredients, filters })
        });
        const data = await resp.json();
        if(!resp.ok) throw new Error(data.error || 'API hatası');

        const recipes = Array.isArray(data.recipes) ? data.recipes : [];
        if(recipes.length===0){
          result.innerHTML = `<div class="p-4 bg-yellow-50 border border-yellow-200 rounded">
            Uygun tarif bulunamadı. Bir-iki malzeme daha deneyin.</div>`;
        }else{
          result.innerHTML = recipes.slice(0,3).map(card).join('');
        }
      }catch(e){
        result.innerHTML = `<div class="p-4 bg-red-50 border border-red-200 rounded">
          Hata: ${e.message}</div>`;
      }finally{
        spinner.classList.add('hidden');
      }
    });

    // Enter ile çalıştırma
    ['ingredients','filters'].forEach(id=>{
      el(id).addEventListener('keydown', e=>{
        if(e.key==='Enter') btn.click();
      });
    });
  </script>
</body>
</html>
